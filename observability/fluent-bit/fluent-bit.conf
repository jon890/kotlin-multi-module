[SERVICE]
    # Fluent Bit 서비스 설정
    Flush         5
    Daemon        off
    Log_Level     info
    Parsers_File  parsers.conf
    HTTP_Server   On
    HTTP_Listen   0.0.0.0
    HTTP_Port     2020
    Health_Check  On

# 컨테이너 로그 수집 (JSON 로그)
[INPUT]
    Name              tail
    Tag               container.logs
    Path              /var/lib/docker/containers/*/*.log
    Parser            docker
    Docker_Mode       On
    Docker_Mode_Flush 5
    Docker_Mode_Parser container_firstline

# 애플리케이션 로그 파일 수집
[INPUT]
    Name              tail
    Tag               app.logs
    Path              /var/log/*.log,/app/logs/*.log
    Parser            json
    Refresh_Interval  5

# 시스템 로그 수집
[INPUT]
    Name              systemd
    Tag               systemd.*
    Systemd_Filter    _SYSTEMD_UNIT=docker.service
    Read_From_Tail    On

# 로그 필터링 및 파싱
[FILTER]
    Name                parser
    Match               container.logs
    Key_Name            log
    Parser              spring_boot
    Reserve_Data        On
    Preserve_Key        On

# OpenSearch로 로그 전송
[OUTPUT]
    Name            opensearch
    Match           container.logs
    Host            opensearch
    Port            9200
    Index           fluent-bit-logs
    Type            _doc

    tls             Off
    tls.verify      Off
    Suppress_Type_Name On

[OUTPUT]
    Name            opensearch
    Match           app.logs
    Host            opensearch
    Port            9200
    Index           application-logs
    Type            _doc
    Suppress_Type_Name On

# 디버깅용 stdout 출력
[OUTPUT]
    Name            stdout
    Match           *
    Format          json_lines
